<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <p id="ly">

    </p>
    <audio
        src="https://ra-sycdn.kuwo.cn/a5449b5610bfb0ea2e0f0723f273d596/655de885/resource/n1/128/62/3/3253201909.mp3?from=vip"
        loop controls id="ad" loop></audio>
    <script src="./js/axios.js"></script>
    <script>
        let lyrics = `
                    [00:00.000] 作词 : 方文山
                    [00:01.000] 作曲 : 周杰伦
                    [00:03.00]编曲：黄雨勋
                    [00:04.00]制作人：周杰伦
                    [00:05.00]录音师：杨瑞代Gary
                    [00:06.00]录音室：JVR Studio
                    [00:07.00]混音工程：杨大纬录音工作室
                    [00:12.09]繁华声 遁入空门 折煞了世人
                    [00:18.01]梦偏冷 辗转一生 情债又几本
                    [00:24.32]如你默认 生死枯等
                    [00:30.55]枯等一圈 又一圈的 年轮
                    [00:36.99]浮图塔 断了几层 断了谁的魂
                    [00:43.28]痛直奔 一盏残灯 倾塌的山门
                    [00:49.26]容我再等 历史转身
                    [00:55.74]等酒香醇 等你弹 一曲古筝
                    [01:02.17]雨纷纷 旧故里草木深
                    [01:08.58]我听闻 你始终一个人
                    [01:14.35]斑驳的城门 盘踞着老树根
                    [01:20.65]石板上回荡的是 再等
                    [01:26.93]雨纷纷 旧故里草木深
                    [01:32.97]我听闻 你仍守着孤城
                    [01:39.40]城郊牧笛声 落在那座野村
                    [01:45.76]缘份落地生根是 我们
                    [01:54.98]听青春 迎来笑声 羡煞许多人
                    [02:01.37]那史册 温柔不肯 下笔都太狠
                    [02:07.39]烟花易冷 人事易分
                    [02:13.51]而你在问 我是否还 认真
                    [02:19.70]千年后 累世情深 还有谁在等
                    [02:25.80]而青史 岂能不真 魏书洛阳城
                    [02:32.08]如你在跟 前世过门
                    [02:39.02]跟着红尘 跟随我 浪迹一生
                    [02:44.97]雨纷纷 旧故里草木深
                    [02:50.96]我听闻 你始终一个人
                    [02:57.47]斑驳的城门 盘踞着老树根
                    [03:03.61]石板上回荡的是 再等
                    [03:09.78]雨纷纷 旧故里草木深
                    [03:15.95]我听闻 你仍守着孤城
                    [03:22.40]城郊牧笛声 落在那座野村
                    [03:28.68]缘份落地生根是 我们
                    [03:35.34]雨纷纷 旧故里草木深
                    [03:37.64]我听闻 你始终一个人
                    [03:39.60]斑驳的城门 盘踞着老树根
                    [03:41.47]石板上回荡的是 再等
                    [03:42.89]雨纷纷 雨纷纷 旧故里草木深
                    [03:44.77]我听闻 我听闻 你仍守着孤城
                    [03:47.48]城郊牧笛声 落在那座野村
                    [03:52.16]缘份落地生根是 我们
                    [03:59.91]缘份落地生根是 我们
                    [04:05.74]伽蓝寺听雨声盼 永恒
                    `
        let arr = [];

        lyrics.replace(/ /g, '').split("\n").filter(el => el).map(el => {
            el.replace(/\[.*?\]/g, str => {
                let res = str.split('')
                res.shift()
                res.pop()
                res = res.join('')
                minute = res.substring(0, res.indexOf(":"))
                second = res.substring(res.indexOf(":") + 1, res.indexOf("."))
                millisecond = res.substring(res.indexOf(".") + 1)
                console.log(minute, second, millisecond, el.substring(el.indexOf("]") + 1));
                second = parseFloat(minute * 60 + second * 1 + millisecond * 0.001)
                ly = el.substring(el.indexOf("]") + 1)
                arr.push({ second, ly })
            })
        })
        let ad = document.getElementById("ad");
        console.log(arr);
        let timer = null
        let offset = 0
        let cur = arr[offset].ly
        ad.onplay = function () {
            timer = null
            timer = setInterval(() => {
                if (ad.currentTime > (arr[offset]?.second)) {
                    cur = arr[offset].ly
                    offset++
                    console.log('change');
                    document.getElementById("ly").innerHTML = cur
                }
                console.log(ad.ended);
            }, 100)

        }

        ad.onpause = function () {
            console.log('pause');
            clearInterval(timer)
        }

        ad.onended = function () {
            console.log('end');
        }


        ad.addEventListener("seeked", function () {
            if (ad.currentTime == 0) { offset = 0; return; };
            console.log('改变了', ad.currentTime);
            for (let i = 0; i < arr.length; i++) {
                if (ad.currentTime > arr[i].second && ad.currentTime < arr[i + 1]?.second) {
                    offset = i;
                    return;
                }
            }
        }) 
    </script>
</body>

</html>